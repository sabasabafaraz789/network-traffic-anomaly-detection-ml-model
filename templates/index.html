<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Security Threat Detection</title>
    <style>
        body { font-family: Arial; max-width: 1200px; margin:0 auto; padding:20px; background:#f5f5f5;}
        .container {background:white; padding:30px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        .form-group {margin-bottom:15px;}
        label {display:block; margin-bottom:5px; font-weight:bold;}
        input {width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;}
        button {background:#007bff; color:white; padding:10px 20px; border:none; border-radius:4px; cursor:pointer; margin-right:10px;}
        button:hover {background:#0056b3;}
        .result {margin-top:20px; padding:15px; border-radius:5px;}
        .benign {background:#d4edda; border:1px solid #c3e6cb; color:#155724;}
        .malicious {background:#f8d7da; border:1px solid #f5c6cb; color:#721c24;}
        .feature-grid {display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:10px; margin-bottom:20px;}
        .tab {overflow:hidden; border:1px solid #ccc; background:#f1f1f1;}
        .tab button {background:inherit; float:left; border:none; outline:none; cursor:pointer; padding:14px 16px; transition:0.3s; color:black;}
        .tab button:hover {background:#ddd;}
        .tab button.active {background:#ccc;}
        .tabcontent {display:none; padding:20px 0;}
    </style>
</head>
<body>
<div class="container">
    <h1>Network Security Threat Detection</h1>
    <p>Detect malicious network traffic in embedded systems</p>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'Single')">Single Prediction</button>
        <button class="tablinks" onclick="openTab(event, 'Batch')">Batch Prediction</button>
    </div>

    <div id="Single" class="tabcontent" style="display:block;">
        <h3>Single Traffic Analysis</h3>
        <div class="feature-grid" id="singleForm"></div>
        <button onclick="predictSingle()">Analyze Traffic</button>
        <div id="singleResult" class="result" style="display:none;"></div>
    </div>

    <div id="Batch" class="tabcontent">
        <h3>Batch Traffic Analysis</h3>
        <textarea id="batchData" rows="10" cols="80" placeholder='Paste JSON array here...'></textarea>
        <br><br>
        <button onclick="predictBatch()">Analyze Batch</button>
        <div id="batchResult" style="margin-top:20px;"></div>
    </div>
</div>

<script>
let features = [];

fetch('/features')
.then(res => res.json())
.then(data => {
    features = data.features;
    initializeForm();
});

function initializeForm() {
    const form = document.getElementById('singleForm');
    features.forEach(feature => {
        const div = document.createElement('div');
        div.className = 'form-group';
        div.innerHTML = `<label for="${feature}">${feature}</label><input type="number" step="any" id="${feature}" value="0">`;
        form.appendChild(div);
    });
}

function openTab(evt, tabName) {
    document.querySelectorAll(".tabcontent").forEach(t => t.style.display = "none");
    document.querySelectorAll(".tablinks").forEach(b => b.classList.remove("active"));
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.classList.add("active");
}

function predictSingle() {
    const data = {};
    features.forEach(feature => {
        let value = parseFloat(document.getElementById(feature).value);
        data[feature] = isNaN(value) ? 0 : value;
    });

    fetch('/predict', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)})
    .then(res => res.json())
    .then(result => {
        const div = document.getElementById("singleResult");
        div.style.display = "block";
        div.className = `result ${result.prediction === 0 ? 'benign' : 'malicious'}`;
        div.innerHTML = `<h3>Analysis Result: ${result.status}</h3>
            <p><strong>Prediction:</strong> ${result.prediction}</p>
            <p><strong>Benign Probability:</strong> ${(result.probability_benign*100).toFixed(2)}%</p>
            <p><strong>Malicious Probability:</strong> ${(result.probability_malicious*100).toFixed(2)}%</p>`;
    }).catch(() => alert("Prediction failed"));
}

function predictBatch() {
    let batchText = document.getElementById("batchData").value;
    try {
        let records = JSON.parse(batchText);
        fetch('/batch_predict', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({records})})
        .then(res => res.json())
        .then(result => {
            const output = document.getElementById("batchResult");
            let html = "<h3>Batch Results</h3>";
            result.results.forEach((item,i) => {
                html += `<div class="result ${item.prediction===0?'benign':'malicious'}" style="margin-bottom:10px;">
                    <strong>Record ${i+1}: ${item.status}</strong><br>
                    Benign: ${(item.probability_benign*100).toFixed(2)}% | Malicious: ${(item.probability_malicious*100).toFixed(2)}%
                </div>`;
            });
            output.innerHTML = html;
        }).catch(() => alert("Batch prediction failed"));
    } catch(e) { alert("Invalid JSON format"); }
}
</script>
</body>
</html>
